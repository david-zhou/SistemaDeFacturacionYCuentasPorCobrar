{% extends "Base.html" %}
{% block titulo %} Factura  {% endblock titulo %}
{%block FacturacionActivo%}active{%endblock FacturacionActivo%}
{% block contenido %}
<div class="containter" style="margin-left:30px; margin-top:20px" >
          <h6 style ="font-family:  'Hoefler Text', Georgia, 'Times New Roman', serif;
                    font-weight: normal;
                    font-size: 1.4em;
                    letter-spacing: .2em;
                    line-height: 1.1em;
                    margin:0px;
                    text-align: left;
                    ">
          Facturar</h6>
  <br><h4>RFC Cliente: </h4><label id="clienteTextBox" style="font-size:12pt; display:inline-block;">Cliente</label>&nbsp&nbsp&nbsp&nbsp <a href="/Seleccionar_ClienteFacturacion/" class="btn btn-success">Seleccionar cliente</a> 
  <h4>Fecha: </h4>
  <script type="text/javascript">
var currentTime = new Date();
var month = currentTime.getMonth() + 1;
var day = currentTime.getDate();
var year = currentTime.getFullYear();
document.write(day + "/" + month + "/" + year);
var rfc="{{rfc}}";
document.getElementById("clienteTextBox").innerHTML=rfc;
</script>
  <!-- Fecha: <br><input type="text" name="Fecha" value=""><br> -->
<div id="tablita" style="height:400px; overflow-y: scroll;">
  <table class = "table table-striped" id ="TablaFactura">
	 <thead>
		<tr>
			<th>Nombre</th>
			<th>Cantidad</th>
			<th>Precio</th>
			<th>Total</th>
		</tr>
	 </thead>
    <tbody>
    </tbody>
  </table>
</div>

    <div id="example" class="modal hide fade in" style="display: none; ">  
    <div class="modal-header">  
    <a class="close" data-dismiss="modal">Ã—</a>  
  <h3>Seleccionar Producto</h3>  
</div>  
<div class="modal-body">  
  Clave del producto:<br><input type="text" name="Producto" id="claveP"><br>
  Nombre del producto:<br><input type="text" name="Nombre" id="nombreP"><br>
   <table class = "table table-striped" id ="TablaProductos">
  <thead>
    <tr>
      <th>Clave</th>
      <th>Nombre</th>
      <th>Descripcion</th>
      <th>Precio</th>
      <th></th>
    </tr>
  </thead>
<tbody>
</tbody>
</table>               
</div>  
<div class="modal-footer">  
  <a onClick="link()" class="btn btn-success">Buscar Producto</a>  
  <a href="#" class="btn" data-dismiss="modal">Cerrar</a>  
</div>  
</div>  
  <a data-toggle="modal" href="#example" class="btn btn-info">Buscar Producto</a>

<div  style="float: right; margin-right:190px">
  <label style="font-size:16pt; display:inline-block;">Subtotal:</label> <label id="subtotal" style="font-size:20pt; color:green; display:inline-block;">$ 0.00</label><br>
  <label style="font-size:16pt; display:inline-block;">Pago:&nbsp&nbsp&nbsp&nbsp</label><input type="text" name="Pago"><br>
 </div>
<br>
<br>
<input type="submit" value = "Generar Factura" class="btn btn-primary">

 </div>

<script>
function link()
{
   var element = document.createElement("input");

     //Assign different attributes to the element.
    element.setAttribute("type", "Button");
    element.setAttribute("value", "Seleccionar");
    element.setAttribute("name", "Button");
    element.setAttribute("class", "btn");
    element.setAttribute("onClick","AgregarProducto()")
    var nomP=document.getElementById("nombreP").value;
    var claP=document.getElementById("claveP").value;
    nomP=nomP.toLowerCase();
    claP=claP.toLowerCase();

  var table=document.getElementById("TablaProductos");
  var rowCount = table.rows.length;
  for (var x=rowCount-1; x>0; x--) {
    table.deleteRow(x);
  }
  {% for p in productos %}
  var iii="{{p.Clave_Producto}}".toLowerCase();
  var yyy="{{p.Nombre}}".toLowerCase();
    if (iii.indexOf(claP) != -1 && yyy.indexOf(nomP) != -1)
    {
      var element = document.createElement("input");

       //Assign different attributes to the element.
      element.setAttribute("type", "Button");
      element.setAttribute("value", "Seleccionar");
      element.setAttribute("name", "Button");
      element.setAttribute("class", "btn");
      element.setAttribute("onClick","AgregarProducto('{{p.Nombre}}','{{p.Precio}}')")
      var row=table.insertRow(-1);
      var cellClave=row.insertCell(0);
      var cellNombre=row.insertCell(1);
      var cellDescripcion=row.insertCell(2);
      var cellPrecio=row.insertCell(3);
      var cellSeleccionar = row.insertCell(4);
      cellClave.innerHTML="{{p.Clave_Producto}}";
      cellNombre.innerHTML="{{p.Nombre}}";
      cellDescripcion.innerHTML = "{{p.Descripcion}}";
      cellPrecio.innerHTML = "{{p.Precio}}";
      cellSeleccionar.appendChild(element);      
    }
    

    {% empty %}

  {% endfor %}
}
function AgregarProducto(Nombre,Precio)
{
    var Borrar = document.createElement("input");
    var Incrementar = document.createElement("input");
    var Decrementar = document.createElement("input");
    Borrar.setAttribute("type", "Button");
    Borrar.setAttribute("value", "Borrar");
    Borrar.setAttribute("name", "Button");
    Borrar.setAttribute("class", "btn btn-danger");
    Incrementar.setAttribute("type", "Button");
    Incrementar.setAttribute("value", "+");
    Incrementar.setAttribute("name", "Button");
    Incrementar.setAttribute("class", "btn");
    Decrementar.setAttribute("type", "Button");
    Decrementar.setAttribute("value", "-");
    Decrementar.setAttribute("name", "Button");
    Decrementar.setAttribute("class", "btn");
    Incrementar.setAttribute("onClick","IncrementarCantidad(this)");
    Decrementar.setAttribute("onClick","DecrementarCantidad(this)");
    Borrar.setAttribute("onClick","Borrar(this)");
    var tableFactura=document.getElementById("TablaFactura");
    var row = tableFactura.insertRow(-1);
    var cellNombre=row.insertCell(0);
    var cellCantidad=row.insertCell(1);
    var cellPrecio=row.insertCell(2);
    var cellTotal=row.insertCell(3);
    var cellBotones = row.insertCell(4);
    cellNombre.innerHTML = Nombre;
    cellCantidad.innerHTML = (1).toFixed(3);
    var precioJ = parseFloat(Precio);
    cellPrecio.innerHTML = precioJ.toFixed(2);
    cellTotal.innerHTML = precioJ.toFixed(2);
    cellBotones.appendChild(Decrementar);
    cellBotones.appendChild(Incrementar);
    cellBotones.appendChild(Borrar);
    actualizarTotal();

}
function actualizarTotal()
{
  var l=document.getElementById('TablaFactura').getElementsByTagName('tr').length;
  var tableFactura = document.getElementById("TablaFactura");
  //alert(l);
  var total = 0.0;
  total=parseFloat(total);
  //alert(l);
  for(var i=1;i<l;i++)
  {
    var costo=parseFloat(tableFactura.rows[i].cells[3].innerHTML);
    total = parseFloat(total) + parseFloat(costo);
  }
  document.getElementById("subtotal").innerHTML = "$ " + total.toFixed(2);
  //alert(total);

}
function IncrementarCantidad(posicion)
{
  var tableFactura=document.getElementById("TablaFactura");
  var rowIndex = posicion.parentNode.parentNode.rowIndex;
  tableFactura.rows[rowIndex].cells[1].innerHTML = (parseFloat(tableFactura.rows[rowIndex].cells[1].innerHTML) + 1).toFixed(3);
  tableFactura.rows[rowIndex].cells[3].innerHTML = (parseFloat(tableFactura.rows[rowIndex].cells[1].innerHTML) *
  parseFloat(tableFactura.rows[rowIndex].cells[2].innerHTML)).toFixed(2);
  actualizarTotal();
}
function DecrementarCantidad(posicion)
{
  var tableFactura=document.getElementById("TablaFactura");
  var rowIndex = posicion.parentNode.parentNode.rowIndex;
  if(!(parseInt(tableFactura.rows[rowIndex].cells[1].innerHTML) - 1 < 1))
  {
    tableFactura.rows[rowIndex].cells[1].innerHTML = (parseFloat(tableFactura.rows[rowIndex].cells[1].innerHTML) - 1).toFixed(3);
    tableFactura.rows[rowIndex].cells[3].innerHTML = (parseFloat(tableFactura.rows[rowIndex].cells[1].innerHTML) *
    parseFloat(tableFactura.rows[rowIndex].cells[2].innerHTML)).toFixed(2);
    actualizarTotal();
  }
}
function Borrar(posicion)
{
  var tableFactura=document.getElementById("TablaFactura");
  var rowIndex = posicion.parentNode.parentNode.rowIndex;
  tableFactura.deleteRow(rowIndex);
  actualizarTotal();
}
</script> 
{% endblock contenido %}
