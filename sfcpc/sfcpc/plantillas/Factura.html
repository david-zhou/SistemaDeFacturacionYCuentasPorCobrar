{% extends "Base.html" %}
{% block titulo %} Factura  {% endblock titulo %}
{%block FacturacionActivo%}active{%endblock FacturacionActivo%}
{% block contenido %}
<div class="containter" style="margin-left:30px; margin-top:20px" >
          <h6 style ="font-family:  'Hoefler Text', Georgia, 'Times New Roman', serif;
                    font-weight: normal;
                    font-size: 1.4em;
                    letter-spacing: .2em;
                    line-height: 1.1em;
                    margin:0px;
                    text-align: left;
                    ">
          Facturar</h6>
  RFC Cliente: <br><input type="text" name="Cliente"><br>
  Fecha: <br><input type="text" name="Fecha" value=""><br>
<div id="tablita" style="height:400px; overflow-y: scroll;">
  <table class = "table table-striped" id ="TablaFactura">
	 <thead>
		<tr>
			<th>Nombre</th>
			<th>Cantidad</th>
			<th>Precio</th>
			<th>Total</th>
		</tr>
	 </thead>
    <tbody>
    </tbody>
  </table>
</div>

    <div id="example" class="modal hide fade in" style="display: none; ">  
    <div class="modal-header">  
    <a class="close" data-dismiss="modal">Ã—</a>  
  <h3>Seleccionar Producto</h3>  
</div>  
<div class="modal-body">  
  Clave del producto:<br><input type="text" name="Producto" id="claveP"><br>
  Nombre del producto:<br><input type="text" name="Nombre" id="nombreP"><br>
   <table class = "table table-striped" id ="TablaProductos">
  <thead>
    <tr>
      <th>Clave</th>
      <th>Nombre</th>
      <th>Descripcion</th>
      <th>Precio</th>
      <th></th>
    </tr>
  </thead>
<tbody>
</tbody>
</table>               
</div>  
<div class="modal-footer">  
  <a onClick="link()" class="btn btn-success">Buscar Producto</a>  
  <a href="#" class="btn" data-dismiss="modal">Cerrar</a>  
</div>  
</div>  
  <a data-toggle="modal" href="#example" class="btn btn-info">Buscar Producto</a>

<div  style="float: right; margin-right:190px">
  Subtotal: <input type="text" name="Subtotal"><br>
  Pago: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input type="text" name="Pago"><br>
 </div>
<br>
<br>
<input type="submit" value = "Generar Factura" class="btn btn-primary">

 </div>

<script>
function link()
{
   var element = document.createElement("input");

     //Assign different attributes to the element.
    element.setAttribute("type", "Button");
    element.setAttribute("value", "Seleccionar");
    element.setAttribute("name", "Button");
    element.setAttribute("class", "btn");
    element.setAttribute("onClick","AgregarProducto()")
    var nomP=document.getElementById("nombreP").value;
    var claP=document.getElementById("claveP").value;
    nomP=nomP.toLowerCase();
    claP=claP.toLowerCase();

  var table=document.getElementById("TablaProductos");
  var rowCount = table.rows.length;
  for (var x=rowCount-1; x>0; x--) {
    table.deleteRow(x);
  }
  {% for p in productos %}
  var iii="{{p.Clave_Producto}}".toLowerCase();
  var yyy="{{p.Nombre}}".toLowerCase();
    if (iii.indexOf(claP) != -1 && yyy.indexOf(nomP) != -1)
    {
      var element = document.createElement("input");

       //Assign different attributes to the element.
      element.setAttribute("type", "Button");
      element.setAttribute("value", "Seleccionar");
      element.setAttribute("name", "Button");
      element.setAttribute("class", "btn");
      element.setAttribute("onClick","AgregarProducto('{{p.Nombre}}','{{p.Precio}}')")
      var row=table.insertRow(-1);
      var cellClave=row.insertCell(0);
      var cellNombre=row.insertCell(1);
      var cellDescripcion=row.insertCell(2);
      var cellPrecio=row.insertCell(3);
      var cellSeleccionar = row.insertCell(4);
      cellClave.innerHTML="{{p.Clave_Producto}}";
      cellNombre.innerHTML="{{p.Nombre}}";
      cellDescripcion.innerHTML = "{{p.Descripcion}}";
      cellPrecio.innerHTML = "{{p.Precio}}";
      cellSeleccionar.appendChild(element);      
    }
    

    {% empty %}

  {% endfor %}
}
function AgregarProducto(Nombre,Precio)
{
    var Borrar = document.createElement("input");
    var Incrementar = document.createElement("input");
    var Decrementar = document.createElement("input");
    Borrar.setAttribute("type", "Button");
    Borrar.setAttribute("value", "Borrar");
    Borrar.setAttribute("name", "Button");
    Borrar.setAttribute("class", "btn btn-danger");
    Incrementar.setAttribute("type", "Button");
    Incrementar.setAttribute("value", "+");
    Incrementar.setAttribute("name", "Button");
    Incrementar.setAttribute("class", "btn");
    Decrementar.setAttribute("type", "Button");
    Decrementar.setAttribute("value", "-");
    Decrementar.setAttribute("name", "Button");
    Decrementar.setAttribute("class", "btn");
    Incrementar.setAttribute("onClick","IncrementarCantidad(this)");
    Decrementar.setAttribute("onClick","DecrementarCantidad(this)");
    Borrar.setAttribute("onClick","Borrar(this)");
    var tableFactura=document.getElementById("TablaFactura");
    var row = tableFactura.insertRow(-1);
    var cellNombre=row.insertCell(0);
    var cellCantidad=row.insertCell(1);
    var cellPrecio=row.insertCell(2);
    var cellTotal=row.insertCell(3);
    var cellBotones = row.insertCell(4);
    cellNombre.innerHTML = Nombre;
    cellCantidad.innerHTML = "1";
    cellPrecio.innerHTML = Precio;
    cellTotal.innerHTML = Precio;
    cellBotones.appendChild(Decrementar);
    cellBotones.appendChild(Incrementar);
    cellBotones.appendChild(Borrar);

}
function IncrementarCantidad(posicion)
{
  var tableFactura=document.getElementById("TablaFactura");
  var rowIndex = posicion.parentNode.parentNode.rowIndex;
  tableFactura.rows[rowIndex].cells[1].innerHTML = parseInt(tableFactura.rows[rowIndex].cells[1].innerHTML) + 1;
  tableFactura.rows[rowIndex].cells[3].innerHTML = parseInt(tableFactura.rows[rowIndex].cells[1].innerHTML) *
  parseInt(tableFactura.rows[rowIndex].cells[2].innerHTML);
}
function DecrementarCantidad(posicion)
{
  var tableFactura=document.getElementById("TablaFactura");
  var rowIndex = posicion.parentNode.parentNode.rowIndex;
  if(!(parseInt(tableFactura.rows[rowIndex].cells[1].innerHTML) - 1 < 1))
  {
    tableFactura.rows[rowIndex].cells[1].innerHTML = parseInt(tableFactura.rows[rowIndex].cells[1].innerHTML) - 1;
    tableFactura.rows[rowIndex].cells[3].innerHTML = parseInt(tableFactura.rows[rowIndex].cells[1].innerHTML) *
    parseInt(tableFactura.rows[rowIndex].cells[2].innerHTML);
  }
}
function Borrar(posicion)
{
  var tableFactura=document.getElementById("TablaFactura");
  var rowIndex = posicion.parentNode.parentNode.rowIndex;
  tableFactura.deleteRow(rowIndex);
}
</script> 
{% endblock contenido %}
